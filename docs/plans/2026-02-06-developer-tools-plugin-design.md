# Noctalia开发者工具插件设计文档

## 项目概述

为Noctalia Shell开发的开发者工具插件，提供状态栏快速访问的实用开发工具集合。插件采用QML + Qt Quick开发，遵循Noctalia插件架构规范。

## 设计决策总结

### 1. 项目结构
- **模式**：插件集合模式，支持未来扩展
- **目录结构**：
  ```
  noctalia-plugins/
  ├── plugins/developer-tools/     # 主插件
  ├── shared/                      # 共享组件
  └── tools/                       # 构建工具
  ```

### 2. 插件类型
- **类型**：Bar Widget（状态栏组件）
- **功能**：开发者工具集合，初始包含两个核心工具

### 3. UI设计
- **布局**：侧边栏导航 + 右侧内容区
- **窗口尺寸**：600×400像素（可调整）
- **交互**：
  - 状态栏按钮点击切换弹出窗口
  - 侧边栏图标切换工具
  - 工具内容区显示当前工具界面

### 4. 工具功能设计

#### 4.1 时间戳转换工具
- **功能**：时间戳 ↔ 日期时间双向转换
- **特性**：
  - 支持Unix秒/毫秒格式
  - 系统时区/UTC选择
  - 多种日期时间格式
  - 实时当前时间显示
  - 转换结果复制功能

#### 4.2 JSON格式化工具
- **功能**：JSON格式化与压缩
- **特性**：
  - 语法高亮显示
  - 格式化（2空格缩进）和压缩切换
  - 实时语法检查
  - 错误提示
  - 格式化结果复制

### 5. 技术架构

#### 5.1 核心组件
- **ToolButton.qml**：状态栏按钮组件
- **Sidebar.qml**：侧边栏导航组件
- **ToolBase.qml**：工具基类（抽象）
- **TimestampTool.qml**：时间戳转换工具
- **JsonFormatter.qml**：JSON格式化工具
- **TextEditor.qml**：代码编辑器组件（复用）

#### 5.2 插件集成
- **manifest.json**：插件配置和元数据
- **pluginApi**：Noctalia API集成
- **Style服务**：主题和样式管理
- **Logger服务**：日志记录

### 6. 扩展性设计

#### 6.1 动态工具注册
```qml
function registerTool(toolName, toolIcon, qmlComponent) {
    // 动态添加新工具到侧边栏
}
```

#### 6.2 配置管理
- 使用Noctalia标准配置系统
- 不保存输入历史（隐私考虑）
- 窗口位置和大小记忆

#### 6.3 未来工具扩展
预留接口支持未来添加：
- Base64编解码
- URL编码
- 正则表达式测试
- 颜色选择器
- 单位转换等

### 7. 国际化支持
- **初始语言**：中文和英文
- **翻译文件**：使用Qt标准的`.qm`文件格式
- **动态切换**：跟随系统语言或手动选择

## 实现计划

### 阶段1：基础设施（1-2天）
1. 创建项目结构和配置文件
2. 实现插件manifest.json
3. 创建基础QML组件结构
4. 设置构建和部署工具

### 阶段2：核心UI组件（2-3天）
1. 实现ToolButton状态栏按钮
2. 实现Sidebar侧边栏导航
3. 实现主窗口布局
4. 集成Noctalia主题系统

### 阶段3：工具实现（3-4天）
1. 实现时间戳转换工具
2. 实现JSON格式化工具
3. 添加复制功能
4. 实现错误处理

### 阶段4：国际化与测试（2-3天）
1. 添加中英文翻译
2. 功能测试和调试
3. 性能优化
4. 文档编写

## 技术细节

### QML架构
- 使用Model-View模式管理工具列表
- 信号/槽机制处理组件间通信
- 属性绑定实现响应式UI
- 组件化设计促进代码复用

### Noctalia API集成
- `pluginApi`：访问插件设置和状态
- `Style`：获取系统主题和颜色
- `Logger`：错误和调试日志
- `Translator`：国际化支持

### 性能考虑
- 懒加载工具组件
- 避免不必要的重绘
- 使用异步处理耗时操作
- 合理管理内存生命周期

## 验收标准

1. ✅ 状态栏显示插件按钮
2. ✅ 点击按钮显示弹出窗口
3. ✅ 侧边栏正确显示工具图标
4. ✅ 时间戳转换工具功能完整
5. ✅ JSON格式化工具功能完整
6. ✅ 中英文语言切换正常
7. ✅ 主题适配系统亮色/暗色模式
8. ✅ 窗口位置和大小记忆
9. ✅ 复制功能正常工作
10. ✅ 错误处理友好提示

## 相关资源

1. [Noctalia插件文档](https://docs.noctalia.dev/development/plugins/overview/)
2. [Quickshell框架文档](https://quickshell.org/docs/v0.2.1/)
3. [Qt QML语言参考](https://doc.qt.io/qt-6/qmlapplications.html)
4. [Qt Quick组件库](https://doc.qt.io/qt-6/qtquickcontrols-index.html)

---
*设计文档创建时间：2026-02-06*
*设计目标：为Noctalia Shell开发实用开发者工具插件*